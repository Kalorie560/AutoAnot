# AutoAnot - 音声自動アノテーションシステム

AutoAnotは、Streamlitベースの音声録音、アノテーション、データセット生成アプリケーションです。音声を録音し、メトリクスの変化に基づいて自動的にセグメントにラベルを付け、アノテーションデータをデータセットとして保存できます。

## 機能

- カスタマイズ可能なサンプリング周波数と録音時間での音声録音
- メトリクス変化閾値に基づく1秒音声セグメントの自動アノテーション
- 色分けされたアノテーション付き音声波形の視覚的表示（緑色="OK"、赤色="NG"）
- 各音声セグメントのメトリクス値表示（RMS、クルトシス、クレストファクタ）
- **手動アノテーション編集機能** - 保存前にユーザが各時間セクションのラベルを変更可能
- 機械学習アプリケーション用の.npzファイルとしてのデータセット生成・保存

## 必要な環境

- Python 3.x
- streamlit
- numpy
- sounddevice
- matplotlib
- scipy

## インストール

リポジトリをクローンして必要な依存関係をインストールしてください：

```bash
# リポジトリをクローン
git clone <repository-url>
cd AutoAnot

# 仮想環境の作成とアクティベート（推奨）
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 依存関係のインストール
pip install streamlit numpy sounddevice matplotlib scipy
```

## 使用方法

1. アプリケーションを起動：

```bash
# オプション1: 提供されたスクリプトを使用
chmod +x run_app.sh
./run_app.sh

# オプション2: streamlitコマンドを直接実行
streamlit run app.py
```

2. Webインターフェースでの操作：
   - サンプリング周波数（Hz）を設定
   - 録音時間（秒）を設定
   - 変化の閾値（%）を設定
   - 使用するメトリクス（RMS、クルトシス、クレストファクタ）を選択
   - 「録音開始」をクリックして録音を開始
   - 録音後、自動的にアノテーションされたセグメントを確認
   - **「アノテーション編集」セクションで各時間セクションのラベルを必要に応じて変更**
   - 「編集後のラベルで波形を更新」で変更結果を視覚的に確認
   - 「データセット保存」をクリックしてアノテーションデータをdataset.npzファイルとして保存

## データセット形式

保存されるデータセットは.npz形式で、以下のコンポーネントを含みます：
- `waveforms`: 音声セグメントの配列（形状: セグメント数 × セグメント当たりのサンプル数）
- `labels`: 各セグメントのラベル配列（"OK"または"NG"）
- `fs`: 録音に使用されたサンプリング周波数
- `metric`: 使用されたメトリクスの種類

## カスタマイズ

- 変化の閾値を調整して自動アノテーションの感度を変更
- `app.py`を編集してアノテーションロジックや可視化パラメータを変更
- `run_app.sh`を変更してサーバーアドレスや追加のstreamlitパラメータを設定

## ライセンス

[ライセンスを指定してください]