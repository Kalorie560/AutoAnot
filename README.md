# AutoAnot - 音声自動アノテーションシステム

AutoAnotは、音声の自動録音、アノテーション、データセット生成を行うStreamlitベースのアプリケーションです。音声を録音し、メトリクス変化に基づいてセグメントを自動的にラベル付けし、アノテーション付きデータをデータセットとして保存できます。

## 機能

- カスタマイズ可能なサンプリングレートと録音時間での音声録音
- メトリクス変化閾値に基づく1秒間隔の音声セグメント自動アノテーション
- カラーコード付きアノテーション（OK=緑、NG=赤）による音声波形の視覚的表示
- 各音声セグメントのメトリクス値表示（RMS、クルトシス、クレストファクタ）
- 機械学習アプリケーション用の.npzファイル形式でのデータセット生成・保存
- **ラベル手動編集機能**: 自動アノテーション後にOK/NGラベルの変更が可能
- **波形確認しながらのラベル編集**: 収録した信号波形を確認しながらラベル変更

## 動作環境

- Python 3.x
- streamlit
- numpy
- sounddevice
- matplotlib
- scipy

## インストール

リポジトリをクローンし、必要な依存関係をインストールしてください：

```bash
# リポジトリのクローン
git clone <repository-url>
cd AutoAnot

# 仮想環境の作成と有効化（推奨）
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 依存関係のインストール
pip install streamlit numpy sounddevice matplotlib scipy
```

## 使用方法

1. アプリケーションの起動：

```bash
# 方法1: 提供されたスクリプトを使用
chmod +x run_app.sh
./run_app.sh

# 方法2: streamlitコマンドを直接実行
streamlit run app.py
```

2. Webインターフェースでの操作：
   - サンプリング周波数（Hz）を設定
   - 録音時間（秒）を設定
   - メトリクス変化閾値（%）を設定
   - 使用するメトリクス（RMS/クルトシス/クレストファクタ）を選択
   - 「録音開始」をクリックして録音開始
   - 録音後、自動アノテーションされたセグメントを確認
   - **必要に応じてOK/NGラベルを手動で変更**
   - 「データセット保存」をクリックしてアノテーション付きデータをdataset.npzファイルとして保存

## データセット形式

保存されるデータセットは.npz形式で、以下のコンポーネントを含みます：
- `waveforms`: 音声セグメントの配列（形状: セグメント数 × セグメント当たりのサンプル数）
- `labels`: 各セグメントのラベル配列（"OK" または "NG"）
- `fs`: 録音に使用されたサンプリング周波数
- `metric`: 使用されたメトリクスの種類

## カスタマイズ

- メトリクス変化閾値を変更して自動アノテーションの感度を調整
- `app.py`を編集してアノテーションロジックや可視化パラメータを変更
- `run_app.sh`を変更してサーバーアドレスや追加のstreamlitパラメータを設定

## ライセンス

[ライセンスを指定してください]